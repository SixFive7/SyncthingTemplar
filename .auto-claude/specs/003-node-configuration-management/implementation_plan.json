{
  "feature": "Node Configuration Management",
  "workflow_type": "feature",
  "workflow_rationale": "New functional capability introducing CRUD interface for Syncthing node management with encrypted credential storage. Builds foundational infrastructure for multi-node monitoring features.",
  "phases": [
    {
      "id": "phase-1-infrastructure",
      "name": "Core Infrastructure Setup",
      "type": "setup",
      "description": "Register required services (Data Protection API, HttpClientFactory) in Program.cs and create base data model",
      "depends_on": [],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-1-1",
          "description": "Register Data Protection API and IHttpClientFactory in Program.cs",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Program.cs"],
          "files_to_create": [],
          "patterns_from": ["src/SyncthingTemplar/Program.cs"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        },
        {
          "id": "subtask-1-2",
          "description": "Create NodeConfiguration data model",
          "service": "SyncthingTemplar",
          "files_to_modify": [],
          "files_to_create": ["src/SyncthingTemplar/Models/NodeConfiguration.cs"],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-2-encryption-service",
      "name": "Encryption Service Implementation",
      "type": "implementation",
      "description": "Build service for encrypting/decrypting API keys using Data Protection API",
      "depends_on": ["phase-1-infrastructure"],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-2-1",
          "description": "Create NodeConfigurationService with encryption methods",
          "service": "SyncthingTemplar",
          "files_to_modify": [],
          "files_to_create": ["src/SyncthingTemplar/Services/NodeConfigurationService.cs"],
          "patterns_from": ["src/SyncthingTemplar/Program.cs"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        },
        {
          "id": "subtask-2-2",
          "description": "Register NodeConfigurationService in Program.cs",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Program.cs"],
          "files_to_create": [],
          "patterns_from": ["src/SyncthingTemplar/Program.cs"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-3-connection-service",
      "name": "Syncthing Connection Service",
      "type": "implementation",
      "description": "Implement service to test Syncthing API connectivity",
      "depends_on": ["phase-1-infrastructure"],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-3-1",
          "description": "Create SyncthingConnectionService with connection test logic",
          "service": "SyncthingTemplar",
          "files_to_modify": [],
          "files_to_create": ["src/SyncthingTemplar/Services/SyncthingConnectionService.cs"],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        },
        {
          "id": "subtask-3-2",
          "description": "Register SyncthingConnectionService in Program.cs",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Program.cs"],
          "files_to_create": [],
          "patterns_from": ["src/SyncthingTemplar/Program.cs"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-4-persistence",
      "name": "Configuration Persistence",
      "type": "implementation",
      "description": "Implement save/load functionality for node configurations with encrypted API keys",
      "depends_on": ["phase-2-encryption-service"],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-4-1",
          "description": "Add SaveNodes and LoadNodes methods to NodeConfigurationService",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Services/NodeConfigurationService.cs"],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-5-dialogs",
      "name": "Dialog Components",
      "type": "implementation",
      "description": "Create MudBlazor dialog components for add/edit/delete operations",
      "depends_on": ["phase-1-infrastructure"],
      "parallel_safe": true,
      "subtasks": [
        {
          "id": "subtask-5-1",
          "description": "Create AddEditNodeDialog component with form validation",
          "service": "SyncthingTemplar",
          "files_to_modify": [],
          "files_to_create": ["src/SyncthingTemplar/Components/Dialogs/AddEditNodeDialog.razor"],
          "patterns_from": ["src/SyncthingTemplar/Components/Pages/Home.razor", "src/SyncthingTemplar/Components/Layout/MainLayout.razor"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        },
        {
          "id": "subtask-5-2",
          "description": "Create DeleteNodeDialog confirmation component",
          "service": "SyncthingTemplar",
          "files_to_modify": [],
          "files_to_create": ["src/SyncthingTemplar/Components/Dialogs/DeleteNodeDialog.razor"],
          "patterns_from": ["src/SyncthingTemplar/Components/Dialogs/AddEditNodeDialog.razor"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-6-page-implementation",
      "name": "Server Management Page",
      "type": "implementation",
      "description": "Implement full CRUD functionality in Servers/Index.razor",
      "depends_on": ["phase-2-encryption-service", "phase-3-connection-service", "phase-4-persistence", "phase-5-dialogs"],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-6-1",
          "description": "Update Servers/Index.razor with node list display and CRUD buttons",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Components/Pages/Servers/Index.razor"],
          "files_to_create": [],
          "patterns_from": ["src/SyncthingTemplar/Components/Pages/Home.razor"],
          "verification": {
            "type": "command",
            "command": "dotnet build ./src/SyncthingTemplar",
            "expected": "Build succeeded"
          },
          "status": "pending"
        },
        {
          "id": "subtask-6-2",
          "description": "Wire up dialog interactions and service calls in Servers/Index.razor",
          "service": "SyncthingTemplar",
          "files_to_modify": ["src/SyncthingTemplar/Components/Pages/Servers/Index.razor"],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "browser",
            "url": "http://localhost:5000/servers",
            "checks": ["Page loads without errors", "Add Server button enabled", "Node list renders"]
          },
          "status": "pending"
        }
      ]
    },
    {
      "id": "phase-7-integration",
      "name": "End-to-End Integration & Testing",
      "type": "integration",
      "description": "Verify complete CRUD workflow and persistence across app restarts",
      "depends_on": ["phase-6-page-implementation"],
      "parallel_safe": false,
      "subtasks": [
        {
          "id": "subtask-7-1",
          "description": "Test add node workflow with connection validation",
          "service": "SyncthingTemplar",
          "all_services": false,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Navigate to /servers",
              "Click Add Server button",
              "Fill form with test data",
              "Test connection (should validate)",
              "Save node",
              "Verify node appears in list"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-2",
          "description": "Test edit and delete operations",
          "service": "SyncthingTemplar",
          "all_services": false,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Click edit on existing node",
              "Modify URL field",
              "Save changes",
              "Verify updated data in list",
              "Click delete on node",
              "Confirm deletion",
              "Verify node removed from list"
            ]
          },
          "status": "pending"
        },
        {
          "id": "subtask-7-3",
          "description": "Verify configuration persistence across application restart",
          "service": "SyncthingTemplar",
          "all_services": false,
          "files_to_modify": [],
          "files_to_create": [],
          "patterns_from": [],
          "verification": {
            "type": "e2e",
            "steps": [
              "Add a test node and save",
              "Stop the application (Ctrl+C)",
              "Restart application (dotnet run)",
              "Navigate to /servers",
              "Verify saved node appears in list",
              "Verify configuration file contains encrypted API key (not plaintext)"
            ]
          },
          "status": "pending"
        }
      ]
    }
  ],
  "summary": {
    "total_phases": 7,
    "total_subtasks": 15,
    "services_involved": ["SyncthingTemplar"],
    "parallelism": {
      "max_parallel_phases": 2,
      "parallel_groups": [
        {
          "phases": ["phase-2-encryption-service", "phase-3-connection-service"],
          "reason": "Both depend only on phase-1, different file sets, can run concurrently"
        },
        {
          "phases": ["phase-4-persistence", "phase-5-dialogs"],
          "reason": "Persistence depends on phase-2, dialogs depend on phase-1 - sequential constraint"
        }
      ],
      "recommended_workers": 1,
      "speedup_estimate": "Limited parallelism due to sequential dependencies in later phases"
    },
    "startup_command": "source auto-claude/.venv/bin/activate && python auto-claude/run.py --spec 003 --parallel 1"
  },
  "verification_strategy": {
    "risk_level": "high",
    "skip_validation": false,
    "test_creation_phase": "post_implementation",
    "test_types_required": ["unit", "integration", "e2e"],
    "security_scanning_required": true,
    "staging_deployment_required": false,
    "acceptance_criteria": [
      "All existing tests pass",
      "New code has test coverage for encryption/decryption",
      "No plaintext API keys in stored configuration files",
      "Connection test validates against real or mocked Syncthing instance",
      "Application restart preserves configurations",
      "No security vulnerabilities in credential handling"
    ],
    "verification_steps": [
      {
        "name": "Unit Tests",
        "command": "dotnet test",
        "expected_outcome": "All tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Integration Tests",
        "command": "dotnet test --filter Category=Integration",
        "expected_outcome": "All integration tests pass",
        "type": "test",
        "required": true,
        "blocking": true
      },
      {
        "name": "Secrets Scan",
        "command": "python auto-claude/scan_secrets.py --all-files --json",
        "expected_outcome": "No plaintext API keys detected",
        "type": "security",
        "required": true,
        "blocking": true
      }
    ],
    "reasoning": "High risk due to security-sensitive credential handling requires comprehensive testing and security scanning"
  },
  "qa_acceptance": {
    "unit_tests": {
      "required": true,
      "commands": ["dotnet test"],
      "minimum_coverage": null
    },
    "integration_tests": {
      "required": true,
      "commands": ["dotnet test --filter Category=Integration"],
      "services_to_test": ["SyncthingTemplar"]
    },
    "e2e_tests": {
      "required": true,
      "commands": [],
      "flows": ["add-node", "edit-node", "delete-node", "app-restart-persistence"]
    },
    "browser_verification": {
      "required": true,
      "pages": [
        {
          "url": "http://localhost:5000/servers",
          "checks": ["renders", "no-console-errors", "add-button-enabled", "node-list-displays"]
        }
      ]
    },
    "database_verification": {
      "required": true,
      "checks": [
        "config-file-exists",
        "api-keys-encrypted",
        "keys-directory-created"
      ]
    }
  },
  "qa_signoff": null
}